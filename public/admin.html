<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrderFi Staff Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #FFF9F5;
      --card: #FFFFFF;
      --text: #2D2A26;
      --text-muted: #6B6560;
      --primary: #E23D28;
      --primary-dark: #C4311F;
      --accent: #FF6B35;
      --fresh: #4CAF50;
      --warm: #FFB347;
      --border: rgba(0,0,0,0.08);
      --success: #4CAF50;
      --error: #E23D28;
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    .serif {
      font-family: 'Playfair Display', Georgia, serif;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-family: 'Lilita One', cursive;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }
    
    .logo a {
      color: inherit;
      text-decoration: none;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
    }
    
    .logout-btn {
      background: var(--cream);
      border: none;
      color: var(--charcoal);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .logout-btn:hover {
      background: white;
      transform: translateY(-1px);
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .page-title {
      font-family: 'Lilita One', cursive;
      font-size: 2.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--charcoal);
    }
    
    .page-subtitle {
      color: var(--muted);
      margin-bottom: 2rem;
    }
    
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid var(--border);
      padding-bottom: 1rem;
    }
    
    .tab {
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .tab:hover {
      color: var(--text);
      background: rgba(0,0,0,0.05);
    }
    
    .tab.active {
      color: white;
      background: var(--primary);
    }
    
    .content-panel {
      display: none;
    }
    
    .content-panel.active {
      display: block;
    }
    
    .add-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.85rem 1.75rem;
      border-radius: 50px;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(226, 61, 40, 0.3);
    }
    
    .add-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(226, 61, 40, 0.4);
    }
    
    .menu-grid {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    
    .category-section {
      background: var(--card);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
      border: 1px solid var(--border);
    }
    
    .category-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border);
    }
    
    .category-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .category-icon.starters { background: rgba(255, 179, 71, 0.2); }
    .category-icon.bar-snacks { background: rgba(255, 179, 71, 0.2); }
    .category-icon.buffalo-wings { background: rgba(226, 61, 40, 0.2); }
    .category-icon.burgers { background: rgba(226, 61, 40, 0.15); }
    .category-icon.dawgs { background: rgba(255, 179, 71, 0.2); }
    .category-icon.tacos { background: rgba(255, 107, 53, 0.2); }
    .category-icon.from-our-grill { background: rgba(226, 61, 40, 0.2); }
    .category-icon.plant-powered { background: rgba(76, 175, 80, 0.2); }
    .category-icon.sides { background: rgba(76, 175, 80, 0.15); }
    .category-icon.desserts { background: rgba(255, 107, 53, 0.15); }
    .category-icon.drinks { background: rgba(33, 150, 243, 0.15); }
    .category-icon.uncategorized { background: rgba(0, 0, 0, 0.08); }
    
    .category-title {
      font-family: 'Lilita One', cursive;
      font-size: 1.35rem;
      color: var(--text);
    }
    
    .category-count {
      background: var(--primary);
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.6rem;
      border-radius: 20px;
      margin-left: auto;
    }
    
    .category-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.25rem;
    }
    
    .menu-card {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      border: 1px solid var(--border);
    }
    
    .menu-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    }
    
    .card-image {
      width: 100%;
      height: 180px;
      background: linear-gradient(135deg, #f8f4f0 0%, #eee8e2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      position: relative;
      overflow: hidden;
    }
    
    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .card-image .placeholder {
      font-size: 4rem;
      opacity: 0.8;
    }
    
    .card-content {
      padding: 1.25rem;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }
    
    .card-name {
      font-family: 'Lilita One', cursive;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .card-price {
      color: var(--primary);
      font-weight: 600;
      font-size: 1.1rem;
    }
    
    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    
    .card-category {
      display: inline-block;
      background: var(--olive);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--cream);
    }
    
    .dietary-badge {
      display: inline-block;
      background: var(--green-fresh);
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.75rem;
      color: white;
    }
    
    .card-desc {
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 1rem;
    }
    
    .card-keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .keyword-tag {
      background: rgba(255, 107, 53, 0.15);
      color: var(--accent);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
    }
    
    .keyword-weight {
      opacity: 0.7;
      margin-left: 0.25rem;
    }
    
    .card-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .card-btn {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .card-btn.edit {
      background: var(--olive);
      color: var(--cream);
    }
    
    .card-btn.edit:hover {
      background: var(--orange);
    }
    
    .card-btn.delete {
      background: transparent;
      color: var(--error);
      border: 1px solid var(--error);
    }
    
    .card-btn.delete:hover {
      background: var(--error);
      color: white;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(42, 42, 42, 0.9);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: var(--card);
      border-radius: 24px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-family: 'Lilita One', cursive;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .modal-close {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      line-height: 1;
    }
    
    .modal-close:hover {
      color: var(--text);
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.25rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-weight: 500;
    }
    
    .form-hint {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }
    
    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      transition: border-color 0.2s;
    }
    
    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    
    .photo-upload {
      border: 2px dashed var(--olive);
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--cream);
    }
    
    .photo-upload:hover {
      border-color: var(--orange);
      background: rgba(232, 112, 63, 0.05);
    }
    
    .photo-upload.has-image {
      padding: 0;
      border: none;
    }
    
    .photo-upload img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
    }
    
    .photo-upload-text {
      color: var(--muted);
    }
    
    .photo-upload-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      opacity: 0.5;
    }
    
    .keywords-editor {
      background: var(--cream);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid rgba(0,0,0,0.08);
    }
    
    .keyword-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      align-items: center;
    }
    
    .keyword-input {
      flex: 2;
      background: white;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 8px;
      padding: 0.5rem;
      color: var(--charcoal);
      font-family: inherit;
    }
    
    .keyword-weight-input {
      flex: 1;
      background: white;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 8px;
      padding: 0.5rem;
      color: var(--charcoal);
      font-family: inherit;
      text-align: center;
    }
    
    .keyword-remove {
      background: transparent;
      border: none;
      color: var(--error);
      cursor: pointer;
      padding: 0.5rem;
      font-size: 1.25rem;
      line-height: 1;
    }
    
    .add-keyword-btn {
      background: transparent;
      border: 1px dashed var(--olive);
      color: var(--olive-dark);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      width: 100%;
      margin-top: 0.5rem;
      transition: all 0.2s;
    }
    
    .add-keyword-btn:hover {
      border-color: var(--orange);
      color: var(--orange);
    }
    
    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid rgba(0,0,0,0.08);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-secondary {
      background: transparent;
      border: 2px solid var(--muted);
      color: var(--charcoal);
    }
    
    .btn-secondary:hover {
      border-color: var(--charcoal);
    }
    
    .btn-primary {
      background: var(--orange);
      border: none;
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(232, 112, 63, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 16px;
      overflow: hidden;
    }
    
    .orders-table th, .orders-table td {
      text-align: left;
      padding: 1rem;
      border-bottom: 1px solid rgba(0,0,0,0.08);
    }
    
    .orders-table th {
      background: var(--olive);
      color: var(--cream);
      font-weight: 500;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .status-pending {
      background: var(--yellow);
      color: var(--charcoal);
    }
    
    .status-preparing {
      background: var(--teal);
      color: white;
    }
    
    .status-ready {
      background: var(--green-fresh);
      color: white;
    }
    
    .status-completed {
      background: rgba(113, 113, 122, 0.2);
      color: #71717a;
    }
    
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: var(--olive);
    }
    
    .login-card {
      background: white;
      border-radius: 24px;
      padding: 3rem;
      text-align: center;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .login-logo {
      font-family: 'Lilita One', cursive;
      font-size: 2rem;
      font-weight: 700;
      color: var(--orange);
      margin-bottom: 1rem;
    }
    
    .login-title {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    
    .login-subtitle {
      color: var(--muted);
      margin-bottom: 2rem;
    }
    
    .replit-login-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: 600;
      width: 100%;
      transition: all 0.2s;
    }
    
    .replit-login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px var(--accent-glow);
    }
    
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem;
      color: var(--muted);
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--dark-surface);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--muted);
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    .empty-state-title {
      font-family: 'Lilita One', cursive;
      font-size: 1.25rem;
      color: var(--charcoal);
      margin-bottom: 0.5rem;
    }
    
    .availability-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .toggle {
      width: 44px;
      height: 24px;
      background: rgba(0,0,0,0.15);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .toggle.active {
      background: var(--green-fresh);
    }
    
    .toggle::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      top: 3px;
      left: 3px;
      transition: transform 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .toggle.active::after {
      transform: translateX(20px);
    }
    
    .hidden { display: none !important; }
    
    /* Configuration Panel Styles */
    .config-sections {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .config-section {
      background: var(--card);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      border: 1px solid var(--border);
    }
    
    .config-section-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .config-icon {
      width: 48px;
      height: 48px;
      background: rgba(226, 61, 40, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .config-section-title {
      font-family: 'Lilita One', cursive;
      font-size: 1.25rem;
      color: var(--text);
      margin-bottom: 0.25rem;
    }
    
    .config-section-desc {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .config-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    
    .config-field {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .config-label {
      font-weight: 500;
      color: var(--text);
      font-size: 0.9rem;
    }
    
    .config-input, .config-select, .config-textarea {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: inherit;
      font-size: 1rem;
      background: var(--bg);
      color: var(--text);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .config-input:focus, .config-select:focus, .config-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(226, 61, 40, 0.1);
    }
    
    .config-textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .config-hint {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .config-toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }
    
    .config-toggle-row:last-of-type {
      border-bottom: none;
    }
    
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 28px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      border-radius: 28px;
      transition: 0.3s;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background-color: var(--fresh);
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(22px);
    }
    
    .config-actions {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    .config-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 50px;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }
    
    .config-btn.primary {
      background: var(--primary);
      color: white;
    }
    
    .config-btn.primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    .config-btn.secondary {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .config-btn.secondary:hover {
      background: #f0ebe6;
    }
    
    .config-status {
      padding: 1rem;
      border-radius: 10px;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .config-status.success {
      background: rgba(76, 175, 80, 0.15);
      color: #2e7d32;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .config-status.error {
      background: rgba(226, 61, 40, 0.15);
      color: #c62828;
      border: 1px solid rgba(226, 61, 40, 0.3);
    }
    
    .config-status.info {
      background: rgba(33, 150, 243, 0.15);
      color: #1565c0;
      border: 1px solid rgba(33, 150, 243, 0.3);
    }
    
    /* WYSIWYG Receipt Preview Styles */
    .receipt-preview-container {
      display: flex;
      gap: 2rem;
      margin-top: 1.5rem;
    }
    
    .receipt-paper {
      background: #fff;
      padding: 1.5rem 1rem;
      font-family: 'Courier New', Courier, monospace;
      font-size: 12px;
      line-height: 1.4;
      min-width: 280px;
      max-width: 320px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border-radius: 2px;
      position: relative;
    }
    
    .receipt-paper::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 0;
      right: 0;
      height: 8px;
      background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 3px,
        #e0e0e0 3px,
        #e0e0e0 6px
      );
    }
    
    .receipt-paper.width-58 {
      min-width: 200px;
      max-width: 220px;
      font-size: 10px;
      padding: 1rem 0.75rem;
    }
    
    .receipt-line {
      padding: 3px 6px;
      margin: 1px 0;
      border-radius: 3px;
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s;
      position: relative;
    }
    
    .receipt-line:hover {
      background: rgba(226, 61, 40, 0.08);
    }
    
    .receipt-line.selected {
      background: rgba(226, 61, 40, 0.15);
      box-shadow: inset 0 0 0 2px var(--primary);
    }
    
    .receipt-line.editing {
      background: rgba(226, 61, 40, 0.1);
    }
    
    .receipt-line.dimmed {
      opacity: 0.3 !important;
      text-decoration: line-through !important;
    }
    
    .receipt-line.dimmed * {
      opacity: 0.3 !important;
      text-decoration: line-through !important;
    }
    
    .price-dimmed {
      opacity: 0.3 !important;
      text-decoration: line-through !important;
    }
    
    /* Receipt Type Tabs */
    .receipt-type-tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .receipt-type-tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      background: #fff;
      border: 2px solid #e8e0db;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .receipt-type-tab:hover {
      border-color: var(--primary);
      background: #fff9f5;
    }
    
    .receipt-type-tab.active {
      border-color: var(--primary);
      background: linear-gradient(135deg, #fff9f5 0%, #ffe5e0 100%);
      box-shadow: 0 4px 12px rgba(226, 61, 40, 0.15);
    }
    
    .receipt-type-tab .tab-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }
    
    .receipt-type-tab .tab-label {
      font-family: 'Lilita One', cursive;
      font-size: 16px;
      color: var(--charcoal);
    }
    
    .receipt-type-tab .tab-desc {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
    }
    
    .receipt-type-tab.active .tab-label {
      color: var(--primary);
    }
    
    .receipt-type-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: #f8f4f0;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #666;
    }
    
    .receipt-type-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
      letter-spacing: 0.5px;
    }
    
    .receipt-type-badge.kitchen {
      background: #FFB347;
      color: #6b3e00;
    }
    
    .receipt-type-badge.tax {
      background: #4CAF50;
      color: #fff;
    }
    
    .config-hint-box {
      padding: 12px 16px;
      background: #fffbeb;
      border: 1px solid #f0e6c8;
      border-radius: 8px;
      font-size: 13px;
      color: #856404;
      margin-top: 8px;
    }
    
    .config-hint-box strong {
      color: #664d00;
    }
    
    /* Kitchen Receipt Preview Styles */
    .receipt-paper.kitchen-receipt {
      border-top: 4px solid #FFB347;
    }
    
    .receipt-paper.tax-receipt {
      border-top: 4px solid #4CAF50;
    }
    
    .receipt-type-indicator {
      text-align: center;
      padding: 8px;
      margin-bottom: 8px;
      font-size: 11px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 4px;
    }
    
    .receipt-type-indicator.kitchen {
      background: #fff3e0;
      color: #e65100;
    }
    
    .receipt-type-indicator.tax {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .kitchen-large-text {
      font-size: 24px !important;
      font-weight: bold !important;
    }
    
    .kitchen-instructions {
      font-style: italic;
      color: #c00;
      font-size: 13px;
      padding: 4px 0;
      border-top: 1px dashed #ddd;
      margin-top: 4px;
    }
    
    .receipt-line-edit {
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--primary);
      color: white;
      border: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 10px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.15s;
    }
    
    .receipt-line:hover .receipt-line-edit {
      opacity: 1;
    }
    
    .receipt-header {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .receipt-subheader {
      text-align: center;
      font-size: 10px;
      color: #666;
      margin-bottom: 12px;
    }
    
    .receipt-divider {
      border: none;
      border-top: 1px dashed #999;
      margin: 8px 0;
    }
    
    .receipt-divider-double {
      border-top: 2px solid #333;
    }
    
    .receipt-row {
      display: flex;
      justify-content: space-between;
    }
    
    .receipt-row-qty {
      display: grid;
      grid-template-columns: 25px 1fr auto;
      gap: 4px;
    }
    
    .receipt-total-row {
      font-weight: bold;
      font-size: 14px;
    }
    
    .receipt-footer-text {
      text-align: center;
      margin-top: 12px;
      font-size: 10px;
    }
    
    .receipt-barcode {
      text-align: center;
      margin-top: 10px;
      font-family: 'Libre Barcode 39', cursive;
      font-size: 36px;
      letter-spacing: -2px;
    }
    
    .receipt-timestamp {
      text-align: center;
      font-size: 10px;
      color: #666;
    }
    
    .receipt-hidden {
      display: none !important;
    }
    
    .receipt-edit-panel {
      flex: 1;
      background: var(--card);
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid var(--border);
      min-height: 200px;
    }
    
    .edit-panel-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      text-align: center;
      padding: 2rem;
    }
    
    .edit-panel-empty-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
      opacity: 0.5;
    }
    
    .edit-panel-title {
      font-family: 'Lilita One', cursive;
      font-size: 1rem;
      color: var(--text);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .edit-field-group {
      margin-bottom: 1rem;
    }
    
    .edit-field-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }
    
    .edit-field-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }
    
    .edit-field-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(226, 61, 40, 0.1);
    }
    
    .line-type-badge {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(226, 61, 40, 0.1);
      color: var(--primary);
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .edit-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .edit-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .edit-btn.apply {
      background: var(--primary);
      color: white;
    }
    
    .edit-btn.apply:hover {
      background: var(--primary-dark);
    }
    
    .edit-btn.reset {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    @media (max-width: 768px) {
      .receipt-preview-container {
        flex-direction: column;
      }
      
      .receipt-paper {
        margin: 0 auto;
      }
    }
    
    .filter-bar {
      background: white;
      border-radius: 16px;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    }
    
    .filter-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    
    .filter-label {
      color: var(--muted);
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .filter-chips {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .filter-chip {
      background: var(--cream);
      border: 1px solid rgba(0,0,0,0.1);
      color: var(--muted);
      padding: 0.4rem 0.85rem;
      border-radius: 20px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .filter-chip:hover {
      color: var(--charcoal);
      border-color: var(--olive);
    }
    
    .filter-chip.active {
      background: var(--orange);
      color: white;
      border-color: var(--orange);
    }
    
    .filter-chip.dietary {
      background: transparent;
      border: 1px solid var(--olive);
      color: var(--olive-dark);
    }
    
    .filter-chip.dietary.active {
      background: var(--green-fresh);
      border-color: var(--green-fresh);
      color: white;
    }
    
    .search-input {
      background: var(--cream);
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 50px;
      padding: 0.5rem 1rem;
      color: var(--charcoal);
      font-family: inherit;
      font-size: 0.9rem;
      min-width: 200px;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--orange);
    }
    
    .search-input::placeholder {
      color: var(--muted);
    }
    
    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .item-count {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      .filter-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .search-input {
        width: 100%;
      }
    }
    
    .tag-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    
    .tag-option {
      background: var(--cream);
      border: 1px solid rgba(0,0,0,0.1);
      color: var(--muted);
      padding: 0.4rem 0.75rem;
      border-radius: 20px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .tag-option:hover {
      border-color: var(--orange);
      color: var(--charcoal);
    }
    
    .tag-option.selected {
      background: var(--green-fresh);
      border-color: var(--green-fresh);
      color: white;
    }
    
    .tag-option.allergen.selected {
      background: var(--coral);
      border-color: var(--coral);
      color: white;
    }
    
    .custom-tag-add {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .custom-tag-add .form-input {
      flex: 1;
    }
    
    .btn-add-tag {
      background: var(--orange);
      color: white;
      border: none;
      width: 40px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.25rem;
      transition: all 0.2s;
    }
    
    .btn-add-tag:hover {
      transform: scale(1.05);
    }
    
    .selected-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .custom-tag {
      background: var(--orange);
      border: none;
      color: white;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .custom-tag .remove-tag {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
      line-height: 1;
      opacity: 0.8;
    }
    
    .custom-tag .remove-tag:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="dashboard-view" class="">
    <header class="header">
      <div class="logo"><a href="/">OrderFi</a></div>
      <div class="user-info">
        <span style="color: rgba(255,255,255,0.8);">Staff Dashboard</span>
        <a href="/" class="logout-btn">Back to Home</a>
      </div>
    </header>

    <main class="container">
      <h1 class="page-title">Dashboard</h1>
      <p class="page-subtitle">Manage your menu and view orders</p>

      <div class="tabs">
        <button class="tab active" data-tab="menu">Menu Items</button>
        <button class="tab" data-tab="orders">Recent Orders</button>
        <button class="tab" data-tab="config">Configuration</button>
      </div>

      <div id="menu-panel" class="content-panel active">
        <div class="filter-bar">
          <div class="filter-section">
            <span class="filter-label">Category:</span>
            <div class="filter-chips" id="category-filters">
              <button class="filter-chip active" data-filter="all">All</button>
              <button class="filter-chip" data-filter="Starters">Starters</button>
              <button class="filter-chip" data-filter="Bar Snacks">Bar Snacks</button>
              <button class="filter-chip" data-filter="Buffalo Wings">Wings</button>
              <button class="filter-chip" data-filter="Burgers">Burgers</button>
              <button class="filter-chip" data-filter="Dawgs">Dawgs</button>
              <button class="filter-chip" data-filter="Tacos">Tacos</button>
              <button class="filter-chip" data-filter="From our grill">Grill</button>
              <button class="filter-chip" data-filter="Plant Powered">Plant Powered</button>
            </div>
          </div>
          <div class="filter-section">
            <span class="filter-label">Dietary:</span>
            <div class="filter-chips" id="dietary-filters">
              <button class="filter-chip dietary" data-dietary="vegetarian">Vegetarian</button>
              <button class="filter-chip dietary" data-dietary="vegan">Vegan</button>
              <button class="filter-chip dietary" data-dietary="gluten-free">Gluten-Free</button>
              <button class="filter-chip dietary" data-dietary="spicy">Spicy</button>
            </div>
          </div>
          <div class="filter-section">
            <input type="text" class="search-input" id="menu-search" placeholder="Search menu items..." oninput="applyFilters()">
          </div>
        </div>
        <div class="menu-header">
          <button class="add-btn" onclick="openAddModal()">
            <span>+</span> Add Menu Item
          </button>
          <span class="item-count" id="item-count"></span>
        </div>
        <div id="menu-grid" class="menu-grid">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>

      <div id="orders-panel" class="content-panel">
        <div id="orders-container">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>

      <div id="config-panel" class="content-panel">
        <div class="config-sections">
          <div class="config-section">
            <div class="config-section-header">
              <div class="config-icon">üñ®Ô∏è</div>
              <div>
                <h3 class="config-section-title">WiFi Printing</h3>
                <p class="config-section-desc">Configure network printer for order receipts</p>
              </div>
            </div>
            
            <div class="config-form">
              <div class="config-toggle-row">
                <label class="config-label">Enable WiFi Printing</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="printer-enabled">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-field">
                <label class="config-label" for="printer-ip">Printer IP Address</label>
                <input type="text" class="config-input" id="printer-ip" placeholder="192.168.1.100">
                <p class="config-hint">The local network IP address of your receipt printer</p>
              </div>
              
              <div class="config-field">
                <label class="config-label" for="printer-port">Port</label>
                <input type="number" class="config-input" id="printer-port" placeholder="9100" value="9100">
                <p class="config-hint">Default port for most network printers is 9100</p>
              </div>
              
              <div class="config-field">
                <label class="config-label" for="printer-type">Printer Type</label>
                <select class="config-select" id="printer-type">
                  <option value="escpos">ESC/POS (Epson, Star, etc.)</option>
                  <option value="zpl">ZPL (Zebra)</option>
                  <option value="raw">Raw Text</option>
                </select>
              </div>
              
              <div class="config-field">
                <label class="config-label" for="printer-width">Paper Width</label>
                <select class="config-select" id="printer-width" onchange="updateReceiptPreview()">
                  <option value="58">58mm (2.25")</option>
                  <option value="80" selected>80mm (3.15")</option>
                </select>
              </div>
              
              <div class="config-actions">
                <button class="config-btn secondary" onclick="testPrinter()">
                  <span>üîå</span> Test Connection
                </button>
                <button class="config-btn primary" onclick="saveConfig()">
                  <span>üíæ</span> Save Settings
                </button>
              </div>
              
              <div id="printer-status" class="config-status" style="display: none;"></div>
            </div>
          </div>
          
          <div class="config-section">
            <div class="config-section-header">
              <div class="config-icon">üìÑ</div>
              <div>
                <h3 class="config-section-title">Receipt Settings</h3>
                <p class="config-section-desc">Configure kitchen and customer receipts separately</p>
              </div>
            </div>
            
            <!-- Receipt Type Tabs -->
            <div class="receipt-type-tabs">
              <button class="receipt-type-tab active" data-type="kitchen" onclick="switchReceiptType('kitchen')">
                <span class="tab-icon">üë®‚Äçüç≥</span>
                <span class="tab-label">Kitchen Receipt</span>
                <span class="tab-desc">For kitchen staff</span>
              </button>
              <button class="receipt-type-tab" data-type="tax" onclick="switchReceiptType('tax')">
                <span class="tab-icon">üßæ</span>
                <span class="tab-label">Customer Receipt</span>
                <span class="tab-desc">Tax receipt for customers</span>
              </button>
            </div>
            
            <!-- Kitchen Receipt Settings -->
            <div class="config-form receipt-settings-panel" id="kitchen-settings">
              <div class="receipt-type-header">
                <span class="receipt-type-badge kitchen">KITCHEN</span>
                <span>What the kitchen sees when preparing orders</span>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print order number (large)</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="kitchen-order-number" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print table/pickup number</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="kitchen-table-number" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print item quantities (large)</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="kitchen-quantities" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print special instructions</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="kitchen-instructions" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print order time</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="kitchen-time" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-hint-box">
                <strong>Tip:</strong> Kitchen receipts focus on what staff need to prepare the order. Prices and customer details are hidden by default.
              </div>
            </div>
            
            <!-- Tax Receipt Settings -->
            <div class="config-form receipt-settings-panel" id="tax-settings" style="display: none;">
              <div class="receipt-type-header">
                <span class="receipt-type-badge tax">CUSTOMER</span>
                <span>What customers receive with their order</span>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print order number</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-order-number" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print customer name</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-customer-name" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print itemized prices</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-prices" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print tax breakdown</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-tax" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print payment method</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-payment" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-toggle-row">
                <label class="config-label">Print barcode</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="print-barcode" checked onchange="updateReceiptVisibility()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="config-field">
                <label class="config-label" for="receipt-footer">Receipt Footer Message</label>
                <textarea class="config-textarea" id="receipt-footer" placeholder="Thank you for your order!" oninput="updateReceiptPreview()"></textarea>
              </div>
            </div>
          </div>
          
          <!-- WYSIWYG Receipt Preview -->
          <div class="config-section">
            <div class="config-section-header">
              <div class="config-icon">üëÅÔ∏è</div>
              <div>
                <h3 class="config-section-title">Receipt Preview</h3>
                <p class="config-section-desc">Click on any line to customize it. Changes update in real-time.</p>
              </div>
            </div>
            
            <div class="receipt-preview-container">
              <!-- Kitchen Receipt Preview -->
              <div id="receipt-paper-kitchen" class="receipt-paper kitchen-receipt">
                <div class="receipt-type-indicator kitchen">üë®‚Äçüç≥ Kitchen Copy</div>
                
                <!-- Large Order Number -->
                <div class="receipt-line" data-line="kitchen-order" data-type="header" id="kitchen-order-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-header kitchen-large-text">ORDER #1234</div>
                </div>
                
                <!-- Table/Pickup Number -->
                <div class="receipt-line" data-line="kitchen-table" data-type="info" id="kitchen-table-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-row" style="justify-content: center; font-size: 18px; font-weight: bold;">
                    <span>üìç Table 5</span>
                  </div>
                </div>
                
                <!-- Order Time -->
                <div class="receipt-line" data-line="kitchen-time" data-type="info" id="kitchen-time-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-timestamp">12:34 PM</div>
                </div>
                
                <hr class="receipt-divider receipt-divider-double">
                
                <!-- Order Items (Large Quantities, No Prices) -->
                <div class="receipt-line" data-line="kitchen-item-1" data-type="item" id="kitchen-item-1" onclick="selectReceiptLine(this)">
                  <div class="receipt-row" style="font-size: 16px;">
                    <span style="font-size: 20px; font-weight: bold; min-width: 40px;">2x</span>
                    <span style="flex: 1;">Classic Burger</span>
                  </div>
                  <div class="kitchen-instructions" id="kitchen-instructions-1">‚ö†Ô∏è No onions, extra pickles</div>
                </div>
                <div class="receipt-line" data-line="kitchen-item-2" data-type="item" id="kitchen-item-2" onclick="selectReceiptLine(this)">
                  <div class="receipt-row" style="font-size: 16px;">
                    <span style="font-size: 20px; font-weight: bold; min-width: 40px;">1x</span>
                    <span style="flex: 1;">Caesar Salad</span>
                  </div>
                  <div class="kitchen-instructions" id="kitchen-instructions-2">‚ö†Ô∏è Dressing on the side</div>
                </div>
                <div class="receipt-line" data-line="kitchen-item-3" data-type="item" id="kitchen-item-3" onclick="selectReceiptLine(this)">
                  <div class="receipt-row" style="font-size: 16px;">
                    <span style="font-size: 20px; font-weight: bold; min-width: 40px;">2x</span>
                    <span style="flex: 1;">Craft Soda</span>
                  </div>
                </div>
                
                <hr class="receipt-divider receipt-divider-double">
                
                <div style="text-align: center; font-size: 12px; color: #666; padding: 8px;">
                  Kitchen Copy - Not for Customer
                </div>
              </div>
              
              <!-- Tax Receipt Preview (Customer Copy) -->
              <div id="receipt-paper-tax" class="receipt-paper tax-receipt" style="display: none;">
                <div class="receipt-type-indicator tax">üßæ Customer Copy</div>
                
                <!-- Receipt Header -->
                <div class="receipt-line" data-line="restaurant-name" data-type="header" onclick="selectReceiptLine(this)">
                  <div class="receipt-header">OrderFi Restaurant</div>
                </div>
                <div class="receipt-line" data-line="restaurant-address" data-type="subheader" onclick="selectReceiptLine(this)">
                  <div class="receipt-subheader">123 Main Street, City<br>Tel: (555) 123-4567</div>
                </div>
                
                <hr class="receipt-divider">
                
                <!-- Order Info -->
                <div class="receipt-line" data-line="order-number" data-type="info" id="receipt-order-number" onclick="selectReceiptLine(this)">
                  <div class="receipt-row">
                    <span>Order #:</span>
                    <span>ORD-1234</span>
                  </div>
                </div>
                <div class="receipt-line" data-line="customer-name" data-type="info" id="receipt-customer-name" onclick="selectReceiptLine(this)">
                  <div class="receipt-row">
                    <span>Customer:</span>
                    <span>John D.</span>
                  </div>
                </div>
                <div class="receipt-line" data-line="timestamp" data-type="info" onclick="selectReceiptLine(this)">
                  <div class="receipt-timestamp">Jan 28, 2026 12:34 PM</div>
                </div>
                
                <hr class="receipt-divider receipt-divider-double">
                
                <!-- Order Items with Prices -->
                <div class="receipt-line" data-line="item-1" data-type="item" onclick="selectReceiptLine(this)">
                  <div class="receipt-row-qty" id="receipt-item-1">
                    <span>2x</span>
                    <span>Classic Burger</span>
                    <span>$25.98</span>
                  </div>
                </div>
                <div class="receipt-line" data-line="item-2" data-type="item" onclick="selectReceiptLine(this)">
                  <div class="receipt-row-qty" id="receipt-item-2">
                    <span>1x</span>
                    <span>Caesar Salad</span>
                    <span>$11.99</span>
                  </div>
                </div>
                <div class="receipt-line" data-line="item-3" data-type="item" onclick="selectReceiptLine(this)">
                  <div class="receipt-row-qty" id="receipt-item-3">
                    <span>2x</span>
                    <span>Craft Soda</span>
                    <span>$7.98</span>
                  </div>
                </div>
                
                <hr class="receipt-divider">
                
                <!-- Totals -->
                <div class="receipt-line" data-line="subtotal" data-type="total" id="receipt-subtotal" onclick="selectReceiptLine(this)">
                  <div class="receipt-row">
                    <span>Subtotal:</span>
                    <span>$45.95</span>
                  </div>
                </div>
                <div class="receipt-line" data-line="tax" data-type="total" id="receipt-tax-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-row">
                    <span>Tax (8%):</span>
                    <span>$3.68</span>
                  </div>
                </div>
                
                <hr class="receipt-divider receipt-divider-double">
                
                <div class="receipt-line" data-line="grand-total" data-type="total" onclick="selectReceiptLine(this)">
                  <div class="receipt-row receipt-total-row">
                    <span>TOTAL:</span>
                    <span>$49.63</span>
                  </div>
                </div>
                
                <!-- Payment Method -->
                <div class="receipt-line" data-line="payment-method" data-type="info" id="receipt-payment-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-row" style="font-size: 12px; color: #666;">
                    <span>Paid via:</span>
                    <span>Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</span>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="receipt-line" data-line="footer-message" data-type="footer" id="receipt-footer-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-footer-text">Thank you for your order!</div>
                </div>
                
                <div class="receipt-line" data-line="barcode" data-type="footer" id="receipt-barcode-line" onclick="selectReceiptLine(this)">
                  <div class="receipt-barcode">*ORD1234*</div>
                </div>
              </div>
              </div>
              
              <!-- Edit Panel -->
              <div class="receipt-edit-panel" id="receipt-edit-panel">
                <div class="edit-panel-empty" id="edit-panel-empty">
                  <div class="edit-panel-empty-icon">‚úèÔ∏è</div>
                  <p>Click on any line in the receipt to edit it</p>
                </div>
                <div id="edit-panel-content" style="display: none;">
                  <div class="edit-panel-title">
                    <span id="edit-line-icon">üìù</span>
                    <span id="edit-line-title">Edit Line</span>
                    <span class="line-type-badge" id="edit-line-type">Header</span>
                  </div>
                  <div id="edit-fields"></div>
                  <div class="edit-actions">
                    <button class="edit-btn apply" onclick="applyLineEdit()">Apply Changes</button>
                    <button class="edit-btn reset" onclick="resetLineEdit()">Reset</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="item-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Add Menu Item</h2>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="item-form">
          <input type="hidden" id="item-id">
          
          <div class="form-group">
            <label class="form-label">Photo</label>
            <div class="photo-upload" id="photo-upload" onclick="document.getElementById('photo-input').click()">
              <div class="photo-upload-icon">üì∑</div>
              <p class="photo-upload-text">Click or drag to upload photo</p>
            </div>
            <input type="file" id="photo-input" accept="image/*" style="display:none" onchange="handlePhotoSelect(event)">
            <input type="hidden" id="photo-url">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="item-name">Name *</label>
              <input type="text" class="form-input" id="item-name" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="item-price">Price *</label>
              <input type="number" step="0.01" class="form-input" id="item-price" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="item-category">Category</label>
            <select class="form-select" id="item-category">
              <option value="Starters">Starters</option>
              <option value="Bar Snacks">Bar Snacks</option>
              <option value="Buffalo Wings">Buffalo Wings</option>
              <option value="Burgers">Burgers</option>
              <option value="Dawgs">Dawgs</option>
              <option value="Tacos">Tacos</option>
              <option value="From our grill">From Our Grill</option>
              <option value="Plant Powered">Plant Powered</option>
              <option value="Sides">Sides</option>
              <option value="Desserts">Desserts</option>
              <option value="Drinks">Drinks</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="item-description">Description</label>
            <textarea class="form-textarea" id="item-description" placeholder="Describe the dish..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="item-reviews">Reviews Link</label>
            <input type="url" class="form-input" id="item-reviews" placeholder="https://yelp.com/biz/...">
            <p class="form-hint">Link to external reviews for this item</p>
          </div>

          <div class="form-group">
            <label class="form-label">AI Keywords</label>
            <p class="form-hint" style="margin-bottom: 0.75rem">Help the AI match customer requests. Weight 0.0-1.0 (higher = stronger match)</p>
            <div class="keywords-editor" id="keywords-editor">
              <div id="keyword-rows"></div>
              <button type="button" class="add-keyword-btn" onclick="addKeywordRow()">+ Add Keyword</button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Dietary Tags</label>
            <p class="form-hint" style="margin-bottom: 0.75rem">Click to toggle tags. These help customers filter the menu.</p>
            <div class="tag-selector" id="dietary-tag-selector">
              <button type="button" class="tag-option" data-tag="vegetarian">Vegetarian</button>
              <button type="button" class="tag-option" data-tag="vegan">Vegan</button>
              <button type="button" class="tag-option" data-tag="gluten-free">Gluten-Free</button>
              <button type="button" class="tag-option" data-tag="dairy-free">Dairy-Free</button>
              <button type="button" class="tag-option" data-tag="spicy">Spicy</button>
              <button type="button" class="tag-option" data-tag="mild">Mild</button>
              <button type="button" class="tag-option" data-tag="keto">Keto</button>
              <button type="button" class="tag-option" data-tag="low-carb">Low-Carb</button>
              <button type="button" class="tag-option" data-tag="halal">Halal</button>
              <button type="button" class="tag-option" data-tag="kosher">Kosher</button>
            </div>
            <div class="custom-tag-add">
              <input type="text" class="form-input" id="custom-dietary-tag" placeholder="Add custom tag...">
              <button type="button" class="btn-add-tag" onclick="addCustomDietaryTag()">+</button>
            </div>
            <div class="selected-tags" id="selected-dietary-tags"></div>
          </div>

          <div class="form-group">
            <label class="form-label">Allergens</label>
            <p class="form-hint" style="margin-bottom: 0.75rem">Click to toggle allergen warnings.</p>
            <div class="tag-selector" id="allergen-tag-selector">
              <button type="button" class="tag-option allergen" data-tag="dairy">Dairy</button>
              <button type="button" class="tag-option allergen" data-tag="gluten">Gluten</button>
              <button type="button" class="tag-option allergen" data-tag="nuts">Nuts</button>
              <button type="button" class="tag-option allergen" data-tag="peanuts">Peanuts</button>
              <button type="button" class="tag-option allergen" data-tag="eggs">Eggs</button>
              <button type="button" class="tag-option allergen" data-tag="soy">Soy</button>
              <button type="button" class="tag-option allergen" data-tag="shellfish">Shellfish</button>
              <button type="button" class="tag-option allergen" data-tag="fish">Fish</button>
              <button type="button" class="tag-option allergen" data-tag="sesame">Sesame</button>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="button" class="btn btn-primary" id="save-btn" onclick="saveItem()">Save Item</button>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let menuItems = [];
    let editingId = null;
    let activeCategory = 'all';
    let activeDietaryTags = new Set();
    let selectedDietaryTags = new Set();
    let selectedAllergens = new Set();
    let customDietaryTags = [];

    function init() {
      loadMenu();
      setupFilters();
      setupTagSelectors();
    }

    function setupTagSelectors() {
      document.querySelectorAll('#dietary-tag-selector .tag-option').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('selected');
          const tag = btn.dataset.tag;
          if (selectedDietaryTags.has(tag)) {
            selectedDietaryTags.delete(tag);
          } else {
            selectedDietaryTags.add(tag);
          }
        });
      });

      document.querySelectorAll('#allergen-tag-selector .tag-option').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('selected');
          const tag = btn.dataset.tag;
          if (selectedAllergens.has(tag)) {
            selectedAllergens.delete(tag);
          } else {
            selectedAllergens.add(tag);
          }
        });
      });
      
      document.getElementById('custom-dietary-tag').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          addCustomDietaryTag();
        }
      });
    }

    function addCustomDietaryTag() {
      const input = document.getElementById('custom-dietary-tag');
      const tag = input.value.trim().toLowerCase();
      if (tag && !customDietaryTags.includes(tag) && !selectedDietaryTags.has(tag)) {
        customDietaryTags.push(tag);
        renderCustomTags();
        input.value = '';
      }
    }

    function removeCustomTag(tag) {
      customDietaryTags = customDietaryTags.filter(t => t !== tag);
      renderCustomTags();
    }

    function renderCustomTags() {
      const container = document.getElementById('selected-dietary-tags');
      container.innerHTML = customDietaryTags.map(tag => `
        <span class="custom-tag">
          ${tag}
          <button type="button" class="remove-tag" onclick="removeCustomTag('${tag}')">√ó</button>
        </span>
      `).join('');
    }

    function resetTagSelectors() {
      selectedDietaryTags.clear();
      selectedAllergens.clear();
      customDietaryTags = [];
      
      document.querySelectorAll('#dietary-tag-selector .tag-option').forEach(btn => {
        btn.classList.remove('selected');
      });
      document.querySelectorAll('#allergen-tag-selector .tag-option').forEach(btn => {
        btn.classList.remove('selected');
      });
      document.getElementById('selected-dietary-tags').innerHTML = '';
    }

    function populateTags(dietaryTags, allergens) {
      resetTagSelectors();
      
      (dietaryTags || []).forEach(tag => {
        const normalizedTag = tag.toLowerCase();
        const btn = document.querySelector(`#dietary-tag-selector .tag-option[data-tag="${normalizedTag}"]`);
        if (btn) {
          btn.classList.add('selected');
          selectedDietaryTags.add(normalizedTag);
        } else {
          customDietaryTags.push(normalizedTag);
        }
      });
      
      (allergens || []).forEach(tag => {
        const normalizedTag = tag.toLowerCase();
        const btn = document.querySelector(`#allergen-tag-selector .tag-option[data-tag="${normalizedTag}"]`);
        if (btn) {
          btn.classList.add('selected');
          selectedAllergens.add(normalizedTag);
        }
      });
      
      renderCustomTags();
    }

    function getSelectedTags() {
      return {
        dietaryTags: [...selectedDietaryTags, ...customDietaryTags],
        allergens: [...selectedAllergens]
      };
    }

    function setupFilters() {
      document.querySelectorAll('#category-filters .filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('#category-filters .filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          activeCategory = chip.dataset.filter;
          applyFilters();
        });
      });

      document.querySelectorAll('#dietary-filters .filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          chip.classList.toggle('active');
          const tag = chip.dataset.dietary;
          if (activeDietaryTags.has(tag)) {
            activeDietaryTags.delete(tag);
          } else {
            activeDietaryTags.add(tag);
          }
          applyFilters();
        });
      });
    }

    function applyFilters() {
      const searchTerm = document.getElementById('menu-search').value.toLowerCase();
      
      const filtered = menuItems.filter(item => {
        if (activeCategory !== 'all' && item.category !== activeCategory) {
          return false;
        }
        
        if (activeDietaryTags.size > 0) {
          const itemTags = (item.dietaryTags || []).map(t => t.toLowerCase());
          const itemKeywords = Object.keys(item.weightedKeywords || {}).map(k => k.toLowerCase());
          const allItemTags = [...itemTags, ...itemKeywords];
          
          for (const tag of activeDietaryTags) {
            if (!allItemTags.some(t => t.includes(tag))) {
              return false;
            }
          }
        }
        
        if (searchTerm) {
          const name = (item.name || '').toLowerCase();
          const desc = (item.description || '').toLowerCase();
          const category = (item.category || '').toLowerCase();
          if (!name.includes(searchTerm) && !desc.includes(searchTerm) && !category.includes(searchTerm)) {
            return false;
          }
        }
        
        return true;
      });

      renderFilteredMenu(filtered);
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-panel`).classList.add('active');
        
        if (tab.dataset.tab === 'orders') {
          loadOrders();
        }
      });
    });

    async function loadMenu() {
      try {
        const res = await fetch('/api/admin/menu', { credentials: 'include' });
        if (!res.ok) throw new Error('Failed to load menu');
        menuItems = await res.json();
        renderMenu();
      } catch (e) {
        console.error('Error loading menu:', e);
        document.getElementById('menu-grid').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <p class="empty-state-title">Failed to load menu</p>
            <p>Please try refreshing the page</p>
          </div>
        `;
      }
    }

    function renderMenu() {
      applyFilters();
    }

    const categoryIcons = {
      'Starters': 'ü•ó',
      'Bar Snacks': 'üçø',
      'Buffalo Wings': 'üçó',
      'Burgers': 'üçî',
      'Dawgs': 'üå≠',
      'Tacos': 'üåÆ',
      'From our grill': 'ü•©',
      'Plant Powered': 'ü•¨',
      'Sides': 'üçü',
      'Desserts': 'üç∞',
      'Drinks': 'ü•§',
      'Uncategorized': 'üì¶'
    };
    
    const categoryOrder = ['Starters', 'Bar Snacks', 'Buffalo Wings', 'Burgers', 'Dawgs', 'Tacos', 'From our grill', 'Plant Powered', 'Sides', 'Desserts', 'Drinks', 'Uncategorized'];

    function renderFilteredMenu(items) {
      const grid = document.getElementById('menu-grid');
      const countEl = document.getElementById('item-count');
      
      countEl.textContent = items.length === menuItems.length 
        ? `${items.length} items` 
        : `${items.length} of ${menuItems.length} items`;
      
      if (menuItems.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üçΩÔ∏è</div>
            <p class="empty-state-title">No menu items yet</p>
            <p>Add your first item to get started</p>
          </div>
        `;
        return;
      }

      if (items.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <p class="empty-state-title">No items match your filters</p>
            <p>Try adjusting your category or dietary filters</p>
          </div>
        `;
        return;
      }

      // Group items by category
      const grouped = {};
      items.forEach(item => {
        const cat = item.category || 'Uncategorized';
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(item);
      });

      // Render grouped by category
      grid.innerHTML = categoryOrder
        .filter(cat => grouped[cat] && grouped[cat].length > 0)
        .map(category => {
          const catItems = grouped[category];
          const catClass = category.toLowerCase().replace(/\s+/g, '-');
          
          const itemsHtml = catItems.map(item => {
            const keywords = item.weightedKeywords || {};
            const dietaryTags = item.dietaryTags || [];
            const keywordTags = Object.entries(keywords).slice(0, 3).map(([k, w]) => 
              `<span class="keyword-tag">${k}<span class="keyword-weight">${w}</span></span>`
            ).join('');
            const dietaryBadges = dietaryTags.slice(0, 2).map(tag => 
              `<span class="dietary-badge">${tag}</span>`
            ).join('');

            return `
              <div class="menu-card" data-category="${item.category || ''}">
                <div class="card-image">
                  ${item.photoUrl 
                    ? `<img src="${item.photoUrl}" alt="${item.name}">`
                    : '<div class="placeholder">üçΩÔ∏è</div>'
                  }
                </div>
                <div class="card-content">
                  <div class="card-header">
                    <span class="card-name">${item.name}</span>
                    <span class="card-price">$${parseFloat(item.price).toFixed(2)}</span>
                  </div>
                  <div class="card-tags">
                    ${dietaryBadges}
                  </div>
                  <p class="card-desc">${item.description || 'No description'}</p>
                  ${keywordTags ? `<div class="card-keywords">${keywordTags}</div>` : ''}
                  <div class="card-actions">
                    <button class="card-btn edit" onclick="editItem(${item.id})">Edit</button>
                    <button class="card-btn delete" onclick="deleteItem(${item.id})">Delete</button>
                  </div>
                </div>
              </div>
            `;
          }).join('');

          return `
            <div class="category-section">
              <div class="category-header">
                <div class="category-icon ${catClass}">${categoryIcons[category] || 'üì¶'}</div>
                <h3 class="category-title">${category}</h3>
                <span class="category-count">${catItems.length} item${catItems.length !== 1 ? 's' : ''}</span>
              </div>
              <div class="category-items">
                ${itemsHtml}
              </div>
            </div>
          `;
        }).join('');
    }

    async function loadOrders() {
      try {
        const res = await fetch('/api/admin/orders', { credentials: 'include' });
        if (!res.ok) throw new Error('Failed to load orders');
        const orders = await res.json();
        renderOrders(orders);
      } catch (e) {
        console.error('Error loading orders:', e);
        document.getElementById('orders-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <p class="empty-state-title">Failed to load orders</p>
          </div>
        `;
      }
    }

    function renderOrders(orders) {
      const container = document.getElementById('orders-container');
      
      if (orders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p class="empty-state-title">No orders yet</p>
            <p>Orders will appear here when customers place them</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            ${orders.map(order => {
              const items = order.items || [];
              const itemNames = items.map(i => i.name).join(', ');
              const statusClass = `status-${(order.status || 'pending').toLowerCase()}`;
              const time = order.createdAt ? new Date(order.createdAt).toLocaleString() : 'N/A';
              return `
                <tr>
                  <td>#${order.id}</td>
                  <td>${itemNames || 'N/A'}</td>
                  <td>$${parseFloat(order.totalAmount || 0).toFixed(2)}</td>
                  <td><span class="status-badge ${statusClass}">${order.status || 'pending'}</span></td>
                  <td>${time}</td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      `;
    }

    function openAddModal() {
      editingId = null;
      document.getElementById('modal-title').textContent = 'Add Menu Item';
      document.getElementById('item-form').reset();
      document.getElementById('item-id').value = '';
      document.getElementById('photo-url').value = '';
      document.getElementById('photo-upload').innerHTML = `
        <div class="photo-upload-icon">üì∑</div>
        <p class="photo-upload-text">Click or drag to upload photo</p>
      `;
      document.getElementById('photo-upload').classList.remove('has-image');
      document.getElementById('keyword-rows').innerHTML = '';
      addKeywordRow();
      resetTagSelectors();
      document.getElementById('item-modal').classList.add('active');
    }

    function editItem(id) {
      const item = menuItems.find(m => m.id === id);
      if (!item) return;

      editingId = id;
      document.getElementById('modal-title').textContent = 'Edit Menu Item';
      document.getElementById('item-id').value = id;
      document.getElementById('item-name').value = item.name || '';
      document.getElementById('item-price').value = item.price || '';
      document.getElementById('item-category').value = item.category || 'Mains';
      document.getElementById('item-description').value = item.description || '';
      document.getElementById('item-reviews').value = item.reviewsUrl || '';
      document.getElementById('photo-url').value = item.photoUrl || '';
      
      populateTags(item.dietaryTags, item.allergens);
      
      if (item.photoUrl) {
        document.getElementById('photo-upload').innerHTML = `<img src="${item.photoUrl}" alt="${item.name}">`;
        document.getElementById('photo-upload').classList.add('has-image');
      } else {
        document.getElementById('photo-upload').innerHTML = `
          <div class="photo-upload-icon">üì∑</div>
          <p class="photo-upload-text">Click or drag to upload photo</p>
        `;
        document.getElementById('photo-upload').classList.remove('has-image');
      }

      document.getElementById('keyword-rows').innerHTML = '';
      const keywords = item.weightedKeywords || {};
      if (Object.keys(keywords).length === 0) {
        addKeywordRow();
      } else {
        Object.entries(keywords).forEach(([k, w]) => addKeywordRow(k, w));
      }

      document.getElementById('item-modal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('item-modal').classList.remove('active');
    }

    function addKeywordRow(keyword = '', weight = 0.5) {
      const row = document.createElement('div');
      row.className = 'keyword-row';
      row.innerHTML = `
        <input type="text" class="keyword-input" value="${keyword}" placeholder="keyword">
        <input type="number" class="keyword-weight-input" value="${weight}" min="0" max="1" step="0.1" placeholder="0.5">
        <button type="button" class="keyword-remove" onclick="this.parentElement.remove()">√ó</button>
      `;
      document.getElementById('keyword-rows').appendChild(row);
    }

    async function handlePhotoSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      const preview = document.getElementById('photo-upload');
      preview.innerHTML = '<div class="spinner" style="margin: 2rem auto;"></div>';

      try {
        const urlRes = await fetch('/api/admin/upload-url', { 
          method: 'POST',
          credentials: 'include'
        });
        if (!urlRes.ok) throw new Error('Failed to get upload URL');
        const { uploadURL, objectPath } = await urlRes.json();

        const uploadRes = await fetch(uploadURL, {
          method: 'PUT',
          body: file,
          headers: { 'Content-Type': file.type }
        });
        if (!uploadRes.ok) throw new Error('Failed to upload photo');

        const publicUrl = await fetch(`/api/object-storage/url?path=${encodeURIComponent(objectPath)}`);
        const { url } = await publicUrl.json();

        document.getElementById('photo-url').value = url;
        preview.innerHTML = `<img src="${url}" alt="Preview">`;
        preview.classList.add('has-image');
      } catch (e) {
        console.error('Upload error:', e);
        preview.innerHTML = `
          <div class="photo-upload-icon">‚ö†Ô∏è</div>
          <p class="photo-upload-text">Upload failed. Click to try again.</p>
        `;
        preview.classList.remove('has-image');
      }
    }

    async function saveItem() {
      const saveBtn = document.getElementById('save-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Saving...';

      try {
        const keywordRows = document.querySelectorAll('.keyword-row');
        const weightedKeywords = {};
        keywordRows.forEach(row => {
          const keyword = row.querySelector('.keyword-input').value.trim();
          const weight = parseFloat(row.querySelector('.keyword-weight-input').value) || 0.5;
          if (keyword) {
            weightedKeywords[keyword] = Math.min(1, Math.max(0, weight));
          }
        });

        const tags = getSelectedTags();
        
        const data = {
          name: document.getElementById('item-name').value,
          price: parseFloat(document.getElementById('item-price').value),
          category: document.getElementById('item-category').value,
          description: document.getElementById('item-description').value,
          reviewsUrl: document.getElementById('item-reviews').value,
          photoUrl: document.getElementById('photo-url').value,
          weightedKeywords,
          dietaryTags: tags.dietaryTags,
          allergens: tags.allergens
        };

        const url = editingId ? `/api/admin/menu/${editingId}` : '/api/admin/menu';
        const method = editingId ? 'PUT' : 'POST';

        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error('Failed to save item');

        closeModal();
        loadMenu();
      } catch (e) {
        console.error('Save error:', e);
        alert('Failed to save item. Please try again.');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save Item';
      }
    }

    async function deleteItem(id) {
      if (!confirm('Are you sure you want to delete this item?')) return;

      try {
        const res = await fetch(`/api/admin/menu/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });
        if (!res.ok) throw new Error('Failed to delete item');
        loadMenu();
      } catch (e) {
        console.error('Delete error:', e);
        alert('Failed to delete item. Please try again.');
      }
    }

    // Configuration management
    function loadConfig() {
      const config = JSON.parse(localStorage.getItem('orderfi_config') || '{}');
      
      // Printer settings
      document.getElementById('printer-enabled').checked = config.printerEnabled || false;
      document.getElementById('printer-ip').value = config.printerIp || '';
      document.getElementById('printer-port').value = config.printerPort || '9100';
      document.getElementById('printer-type').value = config.printerType || 'escpos';
      document.getElementById('printer-width').value = config.printerWidth || '80';
      
      // Receipt settings
      document.getElementById('print-order-number').checked = config.printOrderNumber !== false;
      document.getElementById('print-customer-name').checked = config.printCustomerName !== false;
      document.getElementById('print-prices').checked = config.printPrices !== false;
      document.getElementById('receipt-footer').value = config.receiptFooter || '';
    }

    function saveConfig() {
      const config = {
        printerEnabled: document.getElementById('printer-enabled').checked,
        printerIp: document.getElementById('printer-ip').value,
        printerPort: document.getElementById('printer-port').value,
        printerType: document.getElementById('printer-type').value,
        printerWidth: document.getElementById('printer-width').value,
        printOrderNumber: document.getElementById('print-order-number').checked,
        printCustomerName: document.getElementById('print-customer-name').checked,
        printPrices: document.getElementById('print-prices').checked,
        receiptFooter: document.getElementById('receipt-footer').value
      };
      
      localStorage.setItem('orderfi_config', JSON.stringify(config));
      showStatus('printer-status', 'Settings saved successfully!', 'success');
    }

    function testPrinter() {
      const ip = document.getElementById('printer-ip').value;
      const port = document.getElementById('printer-port').value;
      
      if (!ip) {
        showStatus('printer-status', 'Please enter a printer IP address', 'error');
        return;
      }
      
      showStatus('printer-status', `Testing connection to ${ip}:${port}...`, 'info');
      
      // Simulate connection test (actual implementation would require backend)
      setTimeout(() => {
        showStatus('printer-status', 
          `Connection test complete. Note: Full printer testing requires the printer to be on the same network. Save your settings to enable printing for orders.`, 
          'success'
        );
      }, 1500);
    }

    function showStatus(elementId, message, type) {
      const statusEl = document.getElementById(elementId);
      statusEl.textContent = message;
      statusEl.className = `config-status ${type}`;
      statusEl.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          statusEl.style.display = 'none';
        }, 3000);
      }
    }

    // WYSIWYG Receipt Preview
    let selectedLine = null;
    let receiptConfig = {
      restaurantName: 'OrderFi Restaurant',
      restaurantAddress: '123 Main Street, City',
      restaurantPhone: '(555) 123-4567',
      footerMessage: 'Thank you for your order!'
    };
    
    const lineTypeLabels = {
      'header': 'Restaurant Name',
      'subheader': 'Address & Phone',
      'info': 'Order Info',
      'item': 'Menu Item',
      'total': 'Totals',
      'footer': 'Footer'
    };
    
    const lineTypeIcons = {
      'header': 'üè™',
      'subheader': 'üìç',
      'info': 'üìã',
      'item': 'üçî',
      'total': 'üí∞',
      'footer': 'üìù'
    };
    
    function selectReceiptLine(element) {
      // Remove previous selection
      document.querySelectorAll('.receipt-line.selected').forEach(el => {
        el.classList.remove('selected');
      });
      
      // Select this line
      element.classList.add('selected');
      selectedLine = element;
      
      // Show edit panel
      showEditPanel(element);
    }
    
    function showEditPanel(lineElement) {
      const lineId = lineElement.dataset.line;
      const lineType = lineElement.dataset.type;
      
      document.getElementById('edit-panel-empty').style.display = 'none';
      document.getElementById('edit-panel-content').style.display = 'block';
      
      document.getElementById('edit-line-icon').textContent = lineTypeIcons[lineType] || 'üìù';
      document.getElementById('edit-line-title').textContent = lineTypeLabels[lineType] || 'Edit Line';
      document.getElementById('edit-line-type').textContent = lineType.toUpperCase();
      
      const fieldsContainer = document.getElementById('edit-fields');
      
      // Generate edit fields based on line type
      switch (lineId) {
        case 'restaurant-name':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Restaurant Name</div>
              <input type="text" class="edit-field-input" id="edit-restaurant-name" value="${receiptConfig.restaurantName}">
            </div>
          `;
          break;
          
        case 'restaurant-address':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Street Address</div>
              <input type="text" class="edit-field-input" id="edit-address" value="${receiptConfig.restaurantAddress}">
            </div>
            <div class="edit-field-group">
              <div class="edit-field-label">Phone Number</div>
              <input type="text" class="edit-field-input" id="edit-phone" value="${receiptConfig.restaurantPhone}">
            </div>
          `;
          break;
          
        case 'order-number':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Order Number Format</div>
              <input type="text" class="edit-field-input" id="edit-order-format" value="ORD-{number}" disabled>
              <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">Auto-generated for each order</p>
            </div>
            <div class="edit-field-group" style="margin-top: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="edit-show-order" ${document.getElementById('print-order-number').checked ? 'checked' : ''}>
                <span>Show on receipt</span>
              </label>
            </div>
          `;
          break;
          
        case 'customer-name':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Customer Name Display</div>
              <select class="edit-field-input" id="edit-name-format">
                <option value="full">Full Name (John Doe)</option>
                <option value="first-last" selected>First + Last Initial (John D.)</option>
                <option value="first">First Name Only (John)</option>
              </select>
            </div>
            <div class="edit-field-group" style="margin-top: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="edit-show-customer" ${document.getElementById('print-customer-name').checked ? 'checked' : ''}>
                <span>Show on receipt</span>
              </label>
            </div>
          `;
          break;
          
        case 'timestamp':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Date/Time Format</div>
              <select class="edit-field-input" id="edit-time-format">
                <option value="full" selected>Full (Jan 28, 2026 12:34 PM)</option>
                <option value="date">Date Only (Jan 28, 2026)</option>
                <option value="time">Time Only (12:34 PM)</option>
                <option value="short">Short (1/28/26 12:34)</option>
              </select>
            </div>
          `;
          break;
          
        case 'item-1':
        case 'item-2':
        case 'item-3':
          const itemNum = lineId.split('-')[1];
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Sample Item ${itemNum} (for preview)</div>
              <input type="text" class="edit-field-input" id="edit-item-name" value="${lineElement.querySelector('span:nth-child(2)').textContent}">
            </div>
            <div class="edit-field-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="edit-show-prices" ${document.getElementById('print-prices').checked ? 'checked' : ''}>
                <span>Show item prices</span>
              </label>
            </div>
          `;
          break;
          
        case 'subtotal':
        case 'tax':
        case 'grand-total':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Total Line</div>
              <p style="font-size: 0.85rem; color: var(--text);">This line is calculated automatically from order items.</p>
            </div>
            <div class="edit-field-group" style="margin-top: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="edit-show-totals" checked disabled>
                <span>Always shown</span>
              </label>
            </div>
          `;
          break;
          
        case 'footer-message':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Footer Message</div>
              <textarea class="edit-field-input" id="edit-footer-msg" rows="2" style="min-height: 60px;">${receiptConfig.footerMessage}</textarea>
            </div>
          `;
          break;
          
        case 'barcode':
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <div class="edit-field-label">Barcode</div>
              <p style="font-size: 0.85rem; color: var(--text);">Encodes the order number for easy scanning.</p>
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.5rem;">
                <input type="checkbox" id="edit-show-barcode" checked>
                <span>Show barcode</span>
              </label>
            </div>
          `;
          break;
          
        default:
          fieldsContainer.innerHTML = `
            <div class="edit-field-group">
              <p style="color: var(--text-muted);">This line cannot be customized.</p>
            </div>
          `;
      }
    }
    
    function applyLineEdit() {
      if (!selectedLine) return;
      
      const lineId = selectedLine.dataset.line;
      
      switch (lineId) {
        case 'restaurant-name':
          const newName = document.getElementById('edit-restaurant-name').value;
          receiptConfig.restaurantName = newName;
          selectedLine.querySelector('.receipt-header').textContent = newName;
          break;
          
        case 'restaurant-address':
          const newAddress = document.getElementById('edit-address').value;
          const newPhone = document.getElementById('edit-phone').value;
          receiptConfig.restaurantAddress = newAddress;
          receiptConfig.restaurantPhone = newPhone;
          selectedLine.querySelector('.receipt-subheader').innerHTML = `${newAddress}<br>Tel: ${newPhone}`;
          break;
          
        case 'order-number':
          const showOrder = document.getElementById('edit-show-order').checked;
          document.getElementById('print-order-number').checked = showOrder;
          updateReceiptVisibility();
          break;
          
        case 'customer-name':
          const showCustomer = document.getElementById('edit-show-customer').checked;
          document.getElementById('print-customer-name').checked = showCustomer;
          updateReceiptVisibility();
          break;
          
        case 'item-1':
        case 'item-2':
        case 'item-3':
          const showPrices = document.getElementById('edit-show-prices').checked;
          document.getElementById('print-prices').checked = showPrices;
          updateReceiptVisibility();
          break;
          
        case 'footer-message':
          const newFooter = document.getElementById('edit-footer-msg').value;
          receiptConfig.footerMessage = newFooter;
          selectedLine.querySelector('.receipt-footer-text').textContent = newFooter;
          document.getElementById('receipt-footer').value = newFooter;
          break;
          
        case 'barcode':
          const showBarcode = document.getElementById('edit-show-barcode').checked;
          selectedLine.style.display = showBarcode ? 'block' : 'none';
          break;
      }
      
      // Save receipt config to localStorage
      saveReceiptConfig();
      
      // Flash effect to confirm
      selectedLine.style.background = 'rgba(76, 175, 80, 0.2)';
      setTimeout(() => {
        selectedLine.style.background = '';
      }, 300);
    }
    
    function resetLineEdit() {
      if (selectedLine) {
        showEditPanel(selectedLine);
      }
    }
    
    // Current receipt type being edited
    let currentReceiptType = 'kitchen';
    
    function switchReceiptType(type) {
      currentReceiptType = type;
      
      // Update tab buttons
      document.querySelectorAll('.receipt-type-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.type === type);
      });
      
      // Update settings panels
      document.getElementById('kitchen-settings').style.display = type === 'kitchen' ? 'block' : 'none';
      document.getElementById('tax-settings').style.display = type === 'tax' ? 'block' : 'none';
      
      // Update receipt previews
      document.getElementById('receipt-paper-kitchen').style.display = type === 'kitchen' ? 'block' : 'none';
      document.getElementById('receipt-paper-tax').style.display = type === 'tax' ? 'block' : 'none';
      
      // Clear any selected line
      if (selectedLine) {
        selectedLine.classList.remove('selected');
        selectedLine = null;
      }
      document.getElementById('edit-panel-content').style.display = 'none';
      document.getElementById('edit-panel-empty').style.display = 'block';
      
      // Update visibility based on new type
      updateReceiptVisibility();
    }
    
    function updateReceiptVisibility() {
      // Kitchen receipt visibility
      const showKitchenOrder = document.getElementById('kitchen-order-number')?.checked ?? true;
      const showKitchenTable = document.getElementById('kitchen-table-number')?.checked ?? true;
      const showKitchenQuantities = document.getElementById('kitchen-quantities')?.checked ?? true;
      const showKitchenInstructions = document.getElementById('kitchen-instructions')?.checked ?? true;
      const showKitchenTime = document.getElementById('kitchen-time')?.checked ?? true;
      
      // Kitchen visibility toggles
      const kitchenOrderLine = document.getElementById('kitchen-order-line');
      const kitchenTableLine = document.getElementById('kitchen-table-line');
      const kitchenTimeLine = document.getElementById('kitchen-time-line');
      
      if (kitchenOrderLine) kitchenOrderLine.classList.toggle('dimmed', !showKitchenOrder);
      if (kitchenTableLine) kitchenTableLine.classList.toggle('dimmed', !showKitchenTable);
      if (kitchenTimeLine) kitchenTimeLine.classList.toggle('dimmed', !showKitchenTime);
      
      // Kitchen items quantity styling
      document.querySelectorAll('#receipt-paper-kitchen .receipt-line[data-type="item"]').forEach(item => {
        const qtySpan = item.querySelector('span[style*="font-size: 20px"]');
        if (qtySpan) qtySpan.classList.toggle('dimmed', !showKitchenQuantities);
      });
      
      // Kitchen instructions visibility
      document.querySelectorAll('.kitchen-instructions').forEach(el => {
        el.classList.toggle('dimmed', !showKitchenInstructions);
      });
      
      // Tax receipt visibility
      const showOrderNumber = document.getElementById('print-order-number')?.checked ?? true;
      const showCustomerName = document.getElementById('print-customer-name')?.checked ?? true;
      const showPrices = document.getElementById('print-prices')?.checked ?? true;
      const showTax = document.getElementById('print-tax')?.checked ?? true;
      const showPayment = document.getElementById('print-payment')?.checked ?? true;
      const showBarcode = document.getElementById('print-barcode')?.checked ?? true;
      
      const orderNumberLine = document.getElementById('receipt-order-number');
      const customerNameLine = document.getElementById('receipt-customer-name');
      const taxLine = document.getElementById('receipt-tax-line');
      const paymentLine = document.getElementById('receipt-payment-line');
      const barcodeLine = document.getElementById('receipt-barcode-line');
      
      if (orderNumberLine) orderNumberLine.classList.toggle('dimmed', !showOrderNumber);
      if (customerNameLine) customerNameLine.classList.toggle('dimmed', !showCustomerName);
      if (taxLine) taxLine.classList.toggle('dimmed', !showTax);
      if (paymentLine) paymentLine.classList.toggle('dimmed', !showPayment);
      if (barcodeLine) barcodeLine.classList.toggle('dimmed', !showBarcode);
      
      // Update price visibility on items
      document.querySelectorAll('.receipt-row-qty span:nth-child(3)').forEach(priceEl => {
        if (showPrices) {
          priceEl.classList.remove('price-dimmed');
        } else {
          priceEl.classList.add('price-dimmed');
        }
      });
    }
    
    function updateReceiptPreview() {
      const footerMessage = document.getElementById('receipt-footer').value;
      receiptConfig.footerMessage = footerMessage || 'Thank you for your order!';
      
      const footerLine = document.getElementById('receipt-footer-line');
      if (footerLine) {
        footerLine.querySelector('.receipt-footer-text').textContent = receiptConfig.footerMessage;
      }
      
      // Update paper width based on setting
      const paperWidth = document.getElementById('printer-width').value;
      const receiptPaper = document.getElementById('receipt-paper');
      if (paperWidth === '58') {
        receiptPaper.classList.add('width-58');
      } else {
        receiptPaper.classList.remove('width-58');
      }
      
      updateReceiptVisibility();
    }
    
    function saveReceiptConfig() {
      const config = JSON.parse(localStorage.getItem('orderfi_config') || '{}');
      config.receiptConfig = receiptConfig;
      localStorage.setItem('orderfi_config', JSON.stringify(config));
    }
    
    function loadReceiptConfig() {
      const config = JSON.parse(localStorage.getItem('orderfi_config') || '{}');
      if (config.receiptConfig) {
        receiptConfig = { ...receiptConfig, ...config.receiptConfig };
        
        // Apply loaded config to receipt preview
        const nameEl = document.querySelector('[data-line="restaurant-name"] .receipt-header');
        if (nameEl) nameEl.textContent = receiptConfig.restaurantName;
        
        const addrEl = document.querySelector('[data-line="restaurant-address"] .receipt-subheader');
        if (addrEl) addrEl.innerHTML = `${receiptConfig.restaurantAddress}<br>Tel: ${receiptConfig.restaurantPhone}`;
        
        const footerEl = document.querySelector('[data-line="footer-message"] .receipt-footer-text');
        if (footerEl) footerEl.textContent = receiptConfig.footerMessage;
      }
      
      updateReceiptPreview();
    }
    
    // Add event listeners for config toggles to update preview
    document.getElementById('print-order-number')?.addEventListener('change', updateReceiptVisibility);
    document.getElementById('print-customer-name')?.addEventListener('change', updateReceiptVisibility);
    document.getElementById('print-prices')?.addEventListener('change', updateReceiptVisibility);
    document.getElementById('printer-width')?.addEventListener('change', updateReceiptPreview);

    // Load config when config panel becomes active
    const originalInit = init;
    function init() {
      loadMenu();
      loadOrders();
      loadConfig();
      loadReceiptConfig();
    }

    init();
  </script>
</body>
</html>
